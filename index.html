<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>äºŒå¹´çº§æ•°å­¦é€‰æ‹©é¢˜æµ‹éªŒ</title>
<style>
body {
  font-family: "ZCOOL KuaiLe', 'Microsoft YaHei', sans-serif;
  font-size: 18px;
  background: url('https://static.vecteezy.com/system/resources/previews/033/247/266/non_2x/abstract-background-pink-blue-pastel-color-free-vector.jpg') no-repeat center center fixed;
  background-size: cover;
  padding: 20px;
  color: #000;
  overflow-x: hidden;
}
h1 { font-size: 2.4rem; text-align: center; margin-bottom: 20px; }
#quiz-container { background: rgba(255,255,255,0.85); padding: 24px 28px; border-radius: 20px; max-width: 900px; margin: auto; }
.opt { font-size: 2.1rem; padding: 16px 22px; margin-bottom: 18px; border-radius: 16px; border: 3px solid #d0d0d0; background: rgba(255,255,255,0.95); cursor: pointer; }
.opt.correct { background: rgba(90,220,100,0.9); border-color: #56d56c; }
.opt.wrong { background: rgba(255,200,200,0.9); border-color: #ff7b7b; }
#nextBtn, #finishBtn, #startBtn { font-size: 1.6rem; padding: 12px 26px; background: #7dbbff; border: none; border-radius: 12px; cursor: pointer; margin-top: 20px; }
#finishBtn { display:none; }
#restart { font-size: 1.3rem; padding: 8px 18px; margin-left: 12px; }
#start-page { text-align: center; padding: 20px; }
#start-page input { font-size: 1.4rem; padding: 10px; width: 70%; margin: 10px 0; border-radius: 10px; border: 2px solid #aaa; }
#score { font-size: 1.6rem; margin-top: 15px; }
#result { margin-top: 25px; font-size: 2rem; font-weight: bold; text-align: center; color: #1a1a1a; }
</style>
</head>
<body>

<h1>äºŒå¹´çº§æ•°å­¦é€‰æ‹©é¢˜æµ‹éªŒ</h1>

<div id="start-page">
  <h2>è¯·è¾“å…¥ä½ çš„èµ„æ–™</h2>
  <input id="studentName" placeholder="åå­— Name"><br>
  <input id="studentClass" placeholder="ç­çº§ Class"><br>
  <button id="startBtn">å¼€å§‹æµ‹éªŒ</button>
</div>

<div id="quiz-container" style="display:none;">
  <div id="q-index">ç¬¬ <span id="cur">1</span> / <span id="total">0</span> é¢˜</div>
  <div id="question"></div>
  <div id="options"></div>
  <div class="controls">
    <div class="score" id="score">å¾—åˆ†ï¼š0</div>
    <button id="nextBtn" disabled>ä¸‹ä¸€é¢˜</button>
    <button id="finishBtn">å®Œæˆæµ‹éªŒ</button>
    <button id="restart">é‡åš</button>
  </div>
  <div id="result"></div>
</div>

<script>
// ====== é¢˜åº“ ======
const rawData = `
1,æ•°å­— 605 è¯»ä½œä»€ä¹ˆï¼Ÿ A. å…­ç™¾äº”å B. å…­ç™¾é›¶äº” C. å…­ç™¾äº”é›¶ D. å…­åäº”,B
2,é€‰å‡º â€œå…«ç™¾ä¸€åäºŒâ€ çš„æ•°å­—å†™æ³•ã€‚ A. 812 B. 821 C. 802 D. 820,A
3,åœ¨æ•°ç›® 492 ä¸­ï¼Œæ•°å­— 9 çš„æ•°ä½æ˜¯ä»€ä¹ˆï¼Ÿ A. ä¸ªä½ B. åä½ C. ç™¾ä½ D. åƒä½,B
...
30,è€å¸ˆæœ‰ 40 é¢—ç³–æœï¼Œæ¯ä½å­¦ç”Ÿåˆ† 10 é¢—ï¼Œå¯ä»¥åˆ†ç»™å‡ ä½å­¦ç”Ÿï¼Ÿ A. 3 B. 4 C. 10 D. 50,B
`;

// ====== CSV è½¬æ¢ ======
const data = rawData.trim().split("\n").map(line=>{
  const parts = line.split(",");
  const answer = parts.pop().trim().toUpperCase();
  const qid = parts.shift();
  const full = parts.join(",").trim();
  const optStart = full.indexOf("A.");
  const qtext = full.slice(0, optStart).trim();
  const optRaw = full.slice(optStart);
  const optParts = optRaw.split(/\s(?=[A-D]\.\s)/).map(s=>s.trim());
  const opts = optParts.map(op => op.replace(/^[A-D]\.\s*/, ""));
  while (opts.length < 4) opts.push("(ç¼ºå¤±)");
  return { q: qtext, options: opts, answer: {A:0,B:1,C:2,D:3}[answer] };
});

// ====== å­¦ç”Ÿèµ„æ–™ ======
let studentName="", studentClass="";

// ====== å¼€å§‹æŒ‰é’® ======
document.getElementById("startBtn").addEventListener("click", ()=>{
  studentName = document.getElementById("studentName").value.trim();
  studentClass = document.getElementById("studentClass").value.trim();
  if(!studentName || !studentClass){ alert("è¯·è¾“å…¥åå­—å’Œç­çº§ï¼"); return; }
  document.getElementById("start-page").style.display="none";
  document.getElementById("quiz-container").style.display="block";
  document.getElementById('total').textContent = data.length;
  loadQuestion();
});

// ====== æ˜¾ç¤ºé¢˜ç›® ======
let current=0, score=0, answered=false;
function loadQuestion(){
  answered=false;
  document.getElementById('nextBtn').disabled = true;
  document.getElementById('finishBtn').style.display='none';
  document.getElementById('result').textContent='';
  const q = data[current];
  document.getElementById('question').textContent = q.q;
  document.getElementById('cur').textContent = current+1;
  const optsDiv = document.getElementById('options');
  optsDiv.innerHTML='';
  q.options.forEach((opt,i)=>{
    const div = document.createElement('div');
    div.className='opt';
    div.textContent=opt;
    div.addEventListener('click',()=>selectOption(div,i));
    optsDiv.appendChild(div);
  });
}

function selectOption(el,index){
  if(answered) return;
  answered=true;
  const q = data[current];
  document.querySelectorAll('.opt').forEach((d,i)=>{ if(i===q.answer) d.classList.add('correct'); });
  if(index!==q.answer) el.classList.add('wrong'); else score++;
  document.getElementById('score').textContent='å¾—åˆ†ï¼š'+score;
  if(current === data.length-1){ document.getElementById('finishBtn').style.display='inline-block'; document.getElementById('nextBtn').style.display='none'; }
  else { document.getElementById('nextBtn').disabled=false; }
}

// ====== ä¸‹ä¸€é¢˜ ======
document.getElementById('nextBtn').addEventListener('click', ()=>{ current++; loadQuestion(); });

// ====== å®Œæˆæµ‹éªŒï¼ˆæäº¤åˆ° GASï¼‰ ======
document.getElementById('finishBtn').addEventListener('click', async ()=>{
  const GAS_URL = "https://script.google.com/macros/s/AKfycbxYNeL4SjR7Phcn-3YdiWf3b-n_C2iZiBhxoi-MGw8a/exec";
  try {
    const res = await fetch(GAS_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        name: studentName,
        class: studentClass,
        score: score,
        total: data.length,
        timestamp: new Date().toLocaleString("zh-CN")
      })
    });
    const result = await res.json();
    console.log("æäº¤ç»“æœï¼š", result);
    document.getElementById('result').innerHTML = `ğŸ‰ å¤ªæ£’å•¦ï¼Œ<strong>${studentName}</strong>ï¼ˆ${studentClass}ï¼‰ï¼<br>ä½ å®Œæˆäº†æµ‹éªŒï¼Œæ€»å¾—åˆ†ï¼š${score} / ${data.length} ğŸ’ªğŸŒŸ`;
    document.getElementById('finishBtn').style.display='none';
  } catch(err){
    console.error(err);
    alert("æäº¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åé‡è¯•ã€‚");
  }
});

// ====== é‡åš ======
document.getElementById('restart').addEventListener('click', ()=>{
  if(confirm('ç¡®å®šé‡åšæµ‹éªŒå—ï¼Ÿ')){
    current=0; score=0;
    document.getElementById('score').textContent='å¾—åˆ†ï¼š0';
    document.getElementById('nextBtn').style.display='inline-block';
    document.getElementById('nextBtn').disabled=true;
    loadQuestion();
  }
});
</script>
</body>
</html>
