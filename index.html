<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>äºŒå¹´çº§æ•°å­¦æµ‹éªŒ</title>
<style>
body {
  font-family: 'ZCOOL KuaiLe', 'Microsoft YaHei', sans-serif;
  font-size: 18px;
  background: url('https://static.vecteezy.com/system/resources/previews/033/247/266/non_2x/abstract-background-pink-blue-pastel-color-free-vector.jpg') no-repeat center center fixed;
  background-size: cover;
  padding: 20px;
  color: #000;
}
h1 { text-align:center; margin-bottom:20px; }
#quiz-container, #start-page { max-width: 900px; margin:auto; background: rgba(255,255,255,0.85); padding: 20px; border-radius: 16px; }
input { font-size:16px; padding:8px; margin:8px 0; width:70%; border-radius:8px; border:2px solid #aaa; }
button { font-size:16px; padding:10px 20px; margin-top:10px; border-radius:8px; border:none; background:#7dbbff; cursor:pointer; }
.opt { padding:12px 18px; margin:8px 0; border-radius:12px; border:2px solid #d0d0d0; cursor:pointer; background:rgba(255,255,255,0.95); }
.opt.correct { background:rgba(90,220,100,0.9); border-color:#56d56c; }
.opt.wrong { background:rgba(255,200,200,0.9); border-color:#ff7b7b; }
.score { margin-top:10px; font-size:16px; }
#result { margin-top:20px; font-size:18px; font-weight:bold; }
</style>
</head>
<body>

<h1>äºŒå¹´çº§æ•°å­¦æµ‹éªŒ</h1>

<div id="start-page">
  <h2>è¯·è¾“å…¥ä½ çš„èµ„æ–™</h2>
  <input id="studentName" placeholder="åå­— Name"><br>
  <input id="studentClass" placeholder="ç­çº§ Class"><br>
  <button id="startBtn">å¼€å§‹æµ‹éªŒ</button>
</div>

<div id="quiz-container" style="display:none;">
  <div id="q-index">ç¬¬ <span id="cur">1</span> / <span id="total">0</span> é¢˜</div>
  <div id="question"></div>
  <div id="options"></div>
  <div class="score" id="score">å¾—åˆ†ï¼š0</div>
  <button id="nextBtn" disabled>ä¸‹ä¸€é¢˜</button>
  <button id="finishBtn">å®Œæˆæµ‹éªŒ</button>
  <div id="result"></div>
</div>

<script>
// ====== é¢˜åº“ï¼ˆç¤ºä¾‹ï¼Œå¯æ›¿æ¢å®Œæ•´ 30 é¢˜ï¼‰ ======
const rawData = `
1,æ•°å­— 605 è¯»ä½œä»€ä¹ˆï¼Ÿ A. å…­ç™¾äº”å B. å…­ç™¾é›¶äº” C. å…­ç™¾äº”é›¶ D. å…­åäº”,B
2,é€‰å‡º â€œå…«ç™¾ä¸€åäºŒâ€ çš„æ•°å­—å†™æ³•ã€‚ A. 812 B. 821 C. 802 D. 820,A
3,åœ¨æ•°ç›® 492 ä¸­ï¼Œæ•°å­— 9 çš„æ•°ä½æ˜¯ä»€ä¹ˆï¼Ÿ A. ä¸ªä½ B. åä½ C. ç™¾ä½ D. åƒä½,B
`;

// ====== CSV è½¬æ¢ ======
const data = rawData.trim().split("\n").map(line=>{
  const parts = line.split(",");
  const answer = parts.pop().trim().toUpperCase();
  const qid = parts.shift();
  const full = parts.join(",").trim();
  const optStart = full.indexOf("A.");
  const qtext = full.slice(0,optStart).trim();
  const optRaw = full.slice(optStart);
  const opts = optRaw.split(/\s(?=[A-D]\.\s)/).map(op=>op.replace(/^[A-D]\.\s*/,""));
  while(opts.length<4) opts.push("(ç¼ºå¤±)");
  return { q: qtext, options: opts, answer: {A:0,B:1,C:2,D:3}[answer] };
});

// ====== å­¦ç”Ÿèµ„æ–™ ======
let studentName="", studentClass="";
document.getElementById("startBtn").addEventListener("click", ()=>{
  studentName = document.getElementById("studentName").value.trim();
  studentClass = document.getElementById("studentClass").value.trim();
  if(!studentName||!studentClass){ alert("è¯·è¾“å…¥åå­—å’Œç­çº§ï¼"); return; }
  document.getElementById("start-page").style.display="none";
  document.getElementById("quiz-container").style.display="block";
  document.getElementById('total').textContent = data.length;
  loadQuestion();
});

// ====== æ˜¾ç¤ºé¢˜ç›® ======
let current=0, score=0, answered=false;
function loadQuestion(){
  answered=false;
  document.getElementById('nextBtn').disabled=true;
  document.getElementById('finishBtn').style.display='none';
  document.getElementById('result').textContent='';
  const q = data[current];
  document.getElementById('question').textContent = q.q;
  document.getElementById('cur').textContent = current+1;
  const optsDiv = document.getElementById('options');
  optsDiv.innerHTML='';
  q.options.forEach((opt,i)=>{
    const div = document.createElement('div');
    div.className='opt';
    div.textContent = opt;
    div.addEventListener('click', ()=>selectOption(div,i));
    optsDiv.appendChild(div);
  });
}

function selectOption(el,index){
  if(answered) return;
  answered=true;
  const q = data[current];
  document.querySelectorAll('.opt').forEach((d,i)=>{ if(i===q.answer) d.classList.add('correct'); });
  if(index!==q.answer) el.classList.add('wrong'); else score++;
  document.getElementById('score').textContent='å¾—åˆ†ï¼š'+score;
  if(current===data.length-1){ document.getElementById('finishBtn').style.display='inline-block'; document.getElementById('nextBtn').style.display='none'; }
  else document.getElementById('nextBtn').disabled=false;
}

document.getElementById('nextBtn').addEventListener('click', ()=>{ current++; loadQuestion(); });

// ====== å®Œæˆæµ‹éªŒå¹¶æäº¤ GAS ======
document.getElementById('finishBtn').addEventListener('click', async ()=>{
  const GAS_URL = "https://script.google.com/macros/s/AKfycbxYNeL4SjR7Phcn-3YdiWf3b-n_C2iZiBhxoi-MGw8a/exec"; // æ›¿æ¢ä¸ºä½ çš„ Web App exec URL
  try {
    const res = await fetch(GAS_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({
        name: studentName,
        class: studentClass,
        score: score,
        total: data.length,
        timestamp: new Date()
      })
    });
    const result = await res.json();
    document.getElementById('result').innerHTML = `ğŸ‰ å¤ªæ£’å•¦ï¼Œ<strong>${studentName}</strong>ï¼ˆ${studentClass}ï¼‰ï¼<br>æ€»å¾—åˆ†ï¼š${score}/${data.length}`;
    document.getElementById('finishBtn').style.display='none';
  } catch(err){
    console.error(err);
    alert("æäº¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åé‡è¯•ã€‚");
  }
});
</script>

</body>
</html>
