<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>äºŒå¹´çº§æ•°å­¦æµ‹éªŒ</title>
<style>
/* æ ·å¼åŒå‰é¢çš„å­¦ç”Ÿç«¯ HTML */
</style>
</head>
<body>
<h1>äºŒå¹´çº§æ•°å­¦é€‰æ‹©é¢˜æµ‹éªŒ</h1>

<div id="start-page">
  <h2>è¯·è¾“å…¥ä½ çš„èµ„æ–™</h2>
  <input id="studentName" placeholder="åå­— Name"><br>
  <input id="studentClass" placeholder="ç­çº§ Class"><br>
  <button id="startBtn">å¼€å§‹æµ‹éªŒ</button>
</div>

<div id="quiz-container" style="display:none;">
  <div id="q-index">ç¬¬ <span id="cur">1</span> / <span id="total">0</span> é¢˜</div>
  <div id="question"></div>
  <div id="options"></div>
  <div class="controls">
    <div class="score" id="score">å¾—åˆ†ï¼š0</div>
    <button id="nextBtn" disabled>ä¸‹ä¸€é¢˜</button>
    <button id="finishBtn">å®Œæˆæµ‹éªŒ</button>
    <button id="restart">é‡åš</button>
  </div>
  <div id="result"></div>
</div>

<script>
// ====== é¢˜åº“ ======
// ç®€åŒ–ç¤ºä¾‹ï¼Œå¯æ›¿æ¢ä¸ºå®Œæ•´30é¢˜
const rawData = `1,æ•°å­— 605 è¯»ä½œä»€ä¹ˆï¼Ÿ A. å…­ç™¾äº”å B. å…­ç™¾é›¶äº” C. å…­ç™¾äº”é›¶ D. å…­åäº”,B`;

const data = rawData.trim().split("\n").map(line=>{
  const parts = line.split(",");
  const answer = parts.pop().trim().toUpperCase();
  const qid = parts.shift();
  const full = parts.join(",").trim();
  const optStart = full.indexOf("A.");
  const qtext = full.slice(0, optStart).trim();
  const optRaw = full.slice(optStart);
  const optParts = optRaw.split(/\s(?=[A-D]\.\s)/).map(s=>s.trim());
  const opts = optParts.map(op => op.replace(/^[A-D]\.\s*/, ""));
  while (opts.length < 4) opts.push("(ç¼ºå¤±)");
  return { q: qtext, options: opts, answer: {A:0,B:1,C:2,D:3}[answer] };
});

let studentName="", studentClass="";
document.getElementById("startBtn").addEventListener("click", ()=>{
  studentName = document.getElementById("studentName").value.trim();
  studentClass = document.getElementById("studentClass").value.trim();
  if(!studentName || !studentClass){ alert("è¯·è¾“å…¥åå­—å’Œç­çº§ï¼"); return; }
  document.getElementById("start-page").style.display="none";
  document.getElementById("quiz-container").style.display="block";
  document.getElementById('total').textContent = data.length;
  loadQuestion();
});

let current=0, score=0, answered=false;
function loadQuestion(){
  answered=false;
  document.getElementById('nextBtn').disabled = true;
  document.getElementById('finishBtn').style.display='none';
  document.getElementById('result').textContent='';
  const q = data[current];
  document.getElementById('question').textContent = q.q;
  document.getElementById('cur').textContent = current+1;
  const optsDiv = document.getElementById('options');
  optsDiv.innerHTML='';
  q.options.forEach((opt,i)=>{
    const div = document.createElement('div');
    div.className='opt';
    div.textContent=opt;
    div.addEventListener('click',()=>selectOption(div,i));
    optsDiv.appendChild(div);
  });
}

function selectOption(el,index){
  if(answered) return;
  answered=true;
  const q = data[current];
  document.querySelectorAll('.opt').forEach((d,i)=>{ if(i===q.answer) d.classList.add('correct'); });
  if(index!==q.answer) el.classList.add('wrong'); else score++;
  document.getElementById('score').textContent='å¾—åˆ†ï¼š'+score;
  if(current === data.length-1){ document.getElementById('finishBtn').style.display='inline-block'; document.getElementById('nextBtn').style.display='none'; }
  else { document.getElementById('nextBtn').disabled=false; }
}

document.getElementById('nextBtn').addEventListener('click', ()=>{ current++; loadQuestion(); });

document.getElementById('finishBtn').addEventListener('click', async ()=>{
  const GAS_URL = "https://script.google.com/macros/s/AKfycbxYNeL4SjR7Phcn-3YdiWf3b-n_C2iZiBhxoi-MGw8a/exec";
  try {
    const res = await fetch(GAS_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        name: studentName,
        class: studentClass,
        score: score,
        total: data.length,
        timestamp: new Date().toLocaleString("zh-CN")
      })
    });
    const result = await res.json();
    console.log("æäº¤ç»“æœï¼š", result);
    document.getElementById('result').innerHTML = `ğŸ‰ å¤ªæ£’å•¦ï¼Œ<strong>${studentName}</strong>ï¼ˆ${studentClass}ï¼‰ï¼<br>ä½ å®Œæˆäº†æµ‹éªŒï¼Œæ€»å¾—åˆ†ï¼š${score} / ${data.length} ğŸ’ªğŸŒŸ`;
    document.getElementById('finishBtn').style.display='none';
  } catch(err){
    console.error(err);
    alert("æäº¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åé‡è¯•ã€‚");
  }
});

document.getElementById('restart').addEventListener('click', ()=>{
  if(confirm('ç¡®å®šé‡åšæµ‹éªŒå—ï¼Ÿ')){
    current=0; score=0;
    document.getElementById('score').textContent='å¾—åˆ†ï¼š0';
    document.getElementById('nextBtn').style.display='inline-block';
    document.getElementById('nextBtn').disabled=true;
    loadQuestion();
  }
});
</script>
</body>
</html>
