<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>äºŒå¹´çº§æ•°å­¦é€‰æ‹©é¢˜æµ‹éªŒ</title>
<style>
body {  
  font-family: "ZCOOL KuaiLe", 'Microsoft YaHei', sans-serif;
  font-size: 18px; 
  background: url('https://static.vecteezy.com/system/resources/previews/033/247/266/non_2x/abstract-background-pink-blue-pastel-color-free-vector.jpg') no-repeat center center fixed;
  background-size: cover;
  padding: 20px;
  color: #000;
  overflow-x: hidden;
}
h1 { font-size: 2.4rem; text-align: center; margin-bottom: 20px; }
#q-index { font-size: 1.6rem; margin-bottom: 15px; }
#quiz-container {
  background: rgba(255,255,255,0.85);
  padding: 24px 28px;
  border-radius: 20px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.35), 0 0 20px rgba(255,255,255,0.2) inset;
  backdrop-filter: blur(6px);
  max-width: 900px;
  margin: auto;
  opacity: 80;
  animation: fadeIn 0.8s forwards, floatUpDown 3s ease-in-out infinite alternate;
}
@keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes floatUpDown { 0% { transform: translateY(0px); } 100% { transform: translateY(-6px); } }
#question { font-size: 2rem; margin-bottom: 25px; }
.opt {
  font-size: 2.1rem;
  padding: 16px 22px;
  margin-bottom: 18px;
  border-radius: 16px;
  border: 3px solid #d0d0d0;
  background: rgba(255,255,255,0.95);
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  transition: transform 0.15s, box-shadow 0.15s;
}
.opt:hover { transform: translateY(-3px); box-shadow: 0 6px 16px rgba(0,0,0,0.3); }
.opt.correct { background: rgba(90, 220, 100,0.9); border-color: #56d56c; }
.opt.wrong { background: rgba(255, 200, 200,0.9); border-color: #ff7b7b; }
#nextBtn, #finishBtn, #startBtn { font-size: 1.6rem; padding: 12px 26px; background: #7dbbff; border: none; border-radius: 12px; cursor: pointer; margin-top: 20px; }
#finishBtn { display:none; }
#restart { font-size: 1.3rem; padding: 8px 18px; margin-left: 12px; }
.score { font-size: 1.6rem; margin-top: 15px; }
#result { margin-top: 25px; font-size: 2rem; font-weight: bold; text-align: center; color: #1a1a1a; text-shadow: 1px 1px 3px rgba(0,0,0,0.2); }
#start-page { text-align: center; padding: 20px; }
#start-page input { font-size: 1.4rem; padding: 10px; width: 70%; margin: 10px 0; border-radius: 10px; border: 2px solid #aaa; }
</style>
</head>
<body>

<h1>äºŒå¹´çº§æ•°å­¦é€‰æ‹©é¢˜æµ‹éªŒ</h1>

<div id="start-page" style="display:block;">
  <h2>è¯·è¾“å…¥ä½ çš„èµ„æ–™</h2>
  <input id="studentName" placeholder="åå­— Name"><br>
  <input id="studentClass" placeholder="ç­çº§ Class"><br>
  <button id="startBtn">å¼€å§‹æµ‹éªŒ</button>
</div>

<div id="quiz-container" style="display:none;">
  <div id="q-index">ç¬¬ <span id="cur">1</span> / <span id="total">0</span> é¢˜</div>
  <div id="question"></div>
  <div id="options"></div>
  <div class="controls">
    <div class="score" id="score">å¾—åˆ†ï¼š0</div>
    <button id="nextBtn" disabled>ä¸‹ä¸€é¢˜</button>
    <button id="finishBtn">å®Œæˆæµ‹éªŒ</button>
    <button id="restart">é‡åš</button>
  </div>
  <div id="result"></div>
  <div id="upload-status" style="margin-top:15px;font-size:1.2rem;color:green;"></div>
</div>

<script>
// ====== é¢˜åº“ ======
const rawData = `
// è¿™é‡Œæ”¾ 30 é“é¢˜ï¼Œæ ¼å¼åŒä½ åŸæ¥çš„
1,æ•°å­— 605 è¯»ä½œä»€ä¹ˆï¼Ÿ A. å…­ç™¾äº”å B. å…­ç™¾é›¶äº” C. å…­ç™¾äº”é›¶ D. å…­åäº”,B
2,é€‰å‡º â€œå…«ç™¾ä¸€åäºŒâ€ çš„æ•°å­—å†™æ³•ã€‚ A. 812 B. 821 C. 802 D. 820,A
3,åœ¨æ•°ç›® 492 ä¸­ï¼Œæ•°å­— 9 çš„æ•°ä½æ˜¯ä»€ä¹ˆï¼Ÿ A. ä¸ªä½ B. åä½ C. ç™¾ä½ D. åƒä½,B
// ...çœç•¥ï¼Œå…¶ä½™é¢˜åŒåŸå…ˆ
30,è€å¸ˆæœ‰ 40 é¢—ç³–æœï¼Œæ¯ä½å­¦ç”Ÿåˆ† 10 é¢—ï¼Œå¯ä»¥åˆ†ç»™å‡ ä½å­¦ç”Ÿï¼Ÿ A. 3 B. 4 C. 10 D. 50,B
`;

// ====== CSV è§£æ ======
const data = rawData.trim().split("\n").map(line=>{
  const parts = line.split(",");
  const answer = parts.pop().trim().toUpperCase();
  parts.shift();
  const full = parts.join(",").trim();
  const optStart = full.indexOf("A.");
  const qtext = full.slice(0,optStart).trim();
  const optRaw = full.slice(optStart);
  const optParts = optRaw.split(/\s(?=[A-D]\.\s)/).map(s=>s.trim());
  const opts = optParts.map(op=>op.replace(/^[A-D]\.\s*/,""));
  while(opts.length<4) opts.push("(ç¼ºå¤±)");
  return {q:qtext, options:opts, answer:{A:0,B:1,C:2,D:3}[answer]};
});

// ====== å­¦ç”Ÿèµ„æ–™ ======
let studentName="", studentClass="";
let current=0, score=0, answered=false;

// ====== ç‚¹å‡»å¼€å§‹ ======
document.getElementById("startBtn").addEventListener("click", ()=>{
  studentName=document.getElementById("studentName").value.trim();
  studentClass=document.getElementById("studentClass").value.trim();
  if(!studentName || !studentClass){ alert("è¯·è¾“å…¥åå­—å’Œç­çº§ï¼"); return; }
  document.getElementById("start-page").style.display="none";
  document.getElementById("quiz-container").style.display="block";
  document.getElementById("total").textContent=data.length;
  loadQuestion();
});

// ====== æ˜¾ç¤ºé¢˜ç›® ======
function loadQuestion(){
  answered=false;
  document.getElementById('nextBtn').disabled=true;
  document.getElementById('finishBtn').style.display='none';
  document.getElementById('result').textContent='';
  document.getElementById('upload-status').textContent='';
  const q=data[current];
  document.getElementById('question').textContent=q.q;
  document.getElementById('cur').textContent=current+1;

  const optsDiv=document.getElementById('options');
  optsDiv.innerHTML='';
  q.options.forEach((opt,i)=>{
    const div=document.createElement('div');
    div.className='opt';
    div.textContent=opt;
    div.addEventListener('click',()=>selectOption(div,i));
    optsDiv.appendChild(div);
  });
}

function selectOption(el,index){
  if(answered) return;
  answered=true;
  const q=data[current];
  const all=document.querySelectorAll('.opt');
  all.forEach((d,i)=>{ if(i===q.answer) d.classList.add('correct'); });
  if(index!==q.answer) el.classList.add('wrong'); else score++;
  document.getElementById('score').textContent='å¾—åˆ†ï¼š'+score;

  if(current===data.length-1){
    document.getElementById('finishBtn').style.display='inline-block';
    document.getElementById('nextBtn').style.display='none';
  } else document.getElementById('nextBtn').disabled=false;
}

// ====== ä¸‹ä¸€é¢˜ ======
document.getElementById('nextBtn').addEventListener('click', ()=>{
  current++;
  loadQuestion();
});

// ====== å®Œæˆæµ‹éªŒå¹¶ä¸Šä¼  ======
document.getElementById('finishBtn').addEventListener('click', ()=>{
  const payload={
    studentName,
    className: studentClass,
    score,
    total: data.length,
    timestamp: new Date().toLocaleString("zh-CN")
  };

  fetch("https://script.google.com/macros/s/AKfycbybWyBXhIRUGWA2yUGUWjxEvQ36Eg135O1uutt56UHWI6nvLXXBpqYjslcBugdaZCPUqw/exec", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  })
  .then(res=>res.json())
  .then(r=>{
    console.log("ä¸Šä¼ æˆåŠŸ:", r);
    document.getElementById('upload-status').textContent="âœ… æ•°æ®ä¸Šä¼ æˆåŠŸï¼";
  })
  .catch(err=>{
    console.error("ä¸Šä¼ å¤±è´¥:", err);
    document.getElementById('upload-status').textContent="âŒ æ•°æ®ä¸Šä¼ å¤±è´¥ï¼Œè¯·è”ç³»è€å¸ˆã€‚";
  });

  document.getElementById('result').innerHTML=
    `ğŸ‰ å¤ªæ£’å•¦ï¼Œ<strong>${studentName}</strong>ï¼ˆ${studentClass}ï¼‰ï¼<br>
     ä½ å®Œæˆäº†æµ‹éªŒï¼Œæ€»å¾—åˆ†ï¼š${score} / ${data.length} ğŸ’ªğŸŒŸ`;
  document.getElementById('finishBtn').style.display='none';
});

// ====== é‡åš ======
document.getElementById('restart').addEventListener('click', ()=>{
  if(confirm('ç¡®å®šé‡åšæµ‹éªŒå—ï¼Ÿ')){
    current=0; score=0;
    document.getElementById('score').textContent='å¾—åˆ†ï¼š0';
    document.getElementById('nextBtn').style.display='inline-block';
    document.getElementById('nextBtn').disabled=true;
    loadQuestion();
  }
});
</script>
</body>
</html>
